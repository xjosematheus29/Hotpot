var CopyDesignPageID='hp888';var CopyDesignInitData=null;var DownloadWindow=null;var PreviewBoxContentWindow=null;var CanAcceptPreviewBoxInitEvent=false;let DesignID=null;var MessageBox=null;var MessageBoxTimer=null;var ZoomBox=null;var ActionBox=null;var GroupAlignmentBox=null;var GroupSpaceBox=null;var FullSizeBox=null;var IsDirty=false;var PricingBox=null;var GraphicIconURL="/images/site/graphicIcon.svg";var ControlBox=null;var MainBox=null;var MenuBox=null;var ItemTreePanel=null;var TextPanelContainer=null;var TextPanelPrefix="editor-controls-";var TextPanel=null;var GraphicPanel=null;var ScreenshotPanel=null;var BackgroundPanel=null;var SizePanel=null;var FramePanel=null;var LandscapePanel=null;var MirrorPanel=null;var RotationPanel=null;var FilterPanel=null;var BlurPanel=null;var OpacityPanel=null;var MaskPanel=null;var CornerPanel=null;var RepeatPanel=null;var CollageGridPanel=null;var LastColorClassID=null;var ColorMenu=null;var FontMenu=null;var GraphicMenu=null;var ItemTreeMenu=null;var RepeatMenu=null;var SizeMenu=null;let ScreenshotMenu=null;var RotationMenu=null;var FilterMenu=null;var MaskMenu=null;var BlurMenu=null;var CornerMenu=null;var CollageGridMenu=null;var TranslateMenu=null;var RootMenuResize=null;var RootMenuFile=null;var RootMenuTool=null;var RootMenuHistory=null;var RootMenuTranslate=null;let Db=null;let UserEmailAddress=null;const LogCategoryName='Graphic Editor';const LSUserDesignList='ai.hotpot.editor.design.userDesignListCache';function canInitFromPreviewBox(){return CanAcceptPreviewBoxInitEvent;}
function previewBoxDidFailInit(){var message=`
      <p> So sorry! </p>

      <p> This design is not loading. If you contact us, we will offer free designs as an apology. </p>
   `;if(DesignID){message=message+"<p> Design ID: "+DesignID+"</p>";}
MessageClass.showModal(message);}
function previewBoxDidInit(){CanAcceptPreviewBoxInitEvent=false;finishInitPageFromDesign();}
function previewBoxDidDoubleClickGraphicBox(){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];if(itemData.frameData&&itemData.frameData.graphic){ScreenshotPanel.find(".graphic").trigger("click");}else{GraphicPanel.find(".graphic").trigger("click");}}
function previewBoxDidKeyboardEvent(event){didKeyboardEvent(event);}
function previewBoxDidRotateItem(unit,xValue){setRotationPanel(createRotationData(unit,xValue));}
function previewBoxDidSelection(){setControlBox();}
function previewBoxDidToggleTextPanel(item,show){TextPanel=getTextPanelFor(item);TextPanel.toggle(show);}
function previewBoxDidUndo(){var hideMenus=!ColorMenu.is(":visible");setControlBox(hideMenus);setUndoButton();IsDirty=true;}
function previewBoxDidSetDesignHistory(numEntries){setUndoButton();IsDirty=true;}
function previewBoxDidSetDesignScale(scaleRatio){let percentageString=Math.round(scaleRatio*100)+'%';ZoomBox.find('.curScale').html(percentageString);setZoomBoxButtons();}
function previewBoxDidSetIsSnapping(value){setSnapButton(value);let state=value?'on':'off';let message='Turned snapping '+state;MessageClass.showMessage(message);}
function getDesignInitData(){return CopyDesignInitData;}
function previewBoxWantsInitData(){let initData=null;try{if(window.opener&&window.opener.getDesignInitData){initData=window.opener.getDesignInitData();}}catch(error){}
return initData;}
function previewBoxWantsTextEditorControls(id,jQuery){var controls=addTextPanel(id,jQuery);TextPanel=controls.panel;return controls;}
function previewBoxDidDeleteTextEditor(id){getTextPanelFor(id).remove();}
function previewBoxDidPushDownItem(){MessageClass.showMessage('Moved item down one layer');}
function previewBoxDidPushUpItem(){MessageClass.showMessage('Moved item up one layer');}
function previewBoxDidPushToTopItem(){MessageClass.showMessage('Moved item to top');}
function previewBoxDidPushToBottomItem(){MessageClass.showMessage('Moved item to bottom');}
function setCornerPanel(data){var summary="&mdash;";if(data.topRadius||data.rightRadius||data.bottomRadius||data.leftRadius){summary=data.topRadius+data.unit;}
CornerPanel.find(".summary").html(summary);}
function setRotationPanel(rotationData){if(!rotationData){return;}
var unit="&deg;"
var xRotationString=rotationData.xValue?rotationData.xValue+unit:"&mdash;";RotationPanel.find(".summary").html(xRotationString);}
function setFilterPanel(shadowData){var shadowColor="";if(shadowData.length0||shadowData.length1||shadowData.length2){shadowColor=shadowData.color;}
FilterPanel.find(".color").css("background",shadowColor);FilterPanel.find(".color").toggleClass("transparent",!shadowColor);}
function setOpacityPanel(data){var opacity=roundToStep(data.opacity*100,0);setOpacitySlider(opacity);}
function didSetOpacitySlider(slider){var percentageInt=parseInt(slider.val());var originalValue=percentageInt/100;PreviewBoxContentWindow.editorDidSetOpacity(originalValue);setOpacitySlider(percentageInt);}
function setOpacitySlider(percentageInt){var unit="%";OpacityPanel.find(".slider").val(percentageInt);OpacityPanel.find(".output").html(percentageInt+unit);}
function setBlurPanel(blurData){var summary="&mdash;";if(blurData.length){summary=blurData.length+blurData.unit;}
BlurPanel.find(".summary").html(summary);}
function setMaskPanel(maskURLParam){var imageURL=maskURLParam?"/images/site/maskPanelBackgroundIcon.png":GraphicIconURL;var maskURL=maskURLParam?"url("+maskURLParam+")":"";MaskPanel.find(".graphic img").attr("src",imageURL);MaskPanel.find(".graphic").toggleClass("picker",imageURL===GraphicIconURL);MaskPanel.find(".graphic img").css("-webkit-mask-image",maskURL);}
function setFramePanel(data){if(!data){return;}
var hasGraphic=data.graphic!=null&&data.graphic.url!=null;var graphicURL=hasGraphic?data.graphic.url:GraphicIconURL;setGraphicAndColorGrid(FramePanel,graphicURL,Hotpot.eventTypes.color.changeFrameGraphic);var imgElement=FramePanel.find(".graphic img");var frameWidth="100%";var frameHeight="100%";var frameData=data.clipData;if(frameData&&frameData.width&&frameData.height){imgElement.width("100%");imgElement.height("100%");var maxWidth=imgElement.width();var maxHeight=imgElement.height();var aspectRatio=frameData.width/frameData.height;if(aspectRatio>1){frameWidth=frameData.width>maxWidth?maxWidth:frameData.width;frameHeight=frameWidth*(1/aspectRatio);}else{frameHeight=frameData.height>maxHeight?maxHeight:frameData.height;frameWidth=frameHeight*aspectRatio;}}
imgElement.width(frameWidth);imgElement.height(frameHeight);}
function setLandscapePanel(isLandscape){LandscapePanel.find(".switch").prop("checked",isLandscape);}
function setRepeatPanel(isRepeating,widthRatio){let summary=isRepeating?'On':'&mdash;';RepeatPanel.find('.summary').html(summary);}
function setMirrorPanel(useMirror){MirrorPanel.find('.switch').prop('checked',useMirror);}
function setBackgroundPanel(data){if(!data){return;}
setControlBoxColor(BackgroundPanel.find(".primary.color"),data.color);}
function setControlBoxColor(colorElem,color){if(color){colorElem.removeClass("transparent");colorElem.css("background",color);}else{colorElem.addClass("transparent");colorElem.css("background","");}}
function loadFloatingMenu(floatingMenu){let promise=$.Deferred();floatingMenu.on('load',function(){promise.resolve();});floatingMenu.attr('src',floatingMenu.attr('data-src'));return promise;}
function floatingMenuDidKeyboardEvent(event){if(event.keyCode!=8&&event.keyCode!=46){didKeyboardEvent(event);}}
function menuDidSendMessage(message){MessageClass.showMessage(message);}
function showItemTreeMenu(toolBoxElem){var itemTree=PreviewBoxContentWindow.editorWantsItemTree();ItemTreeMenu[0].contentWindow.configure(itemTree);showFloatingMenu(ItemTreeMenu,toolBoxElem);}
function itemTreeMenuDidSelectItem(itemID){PreviewBoxContentWindow.editorDidSelectItem(itemID);}
function translateMenuDidReplaceText(textList){var initData={replacementTextList:textList};copyDesign(initData);var logDetails="Num text: "+textList.length;logEvent(LogCategoryName,"Replaced text",logDetails);}
function translateMenuDidStartRequest(textList,languageCode){let logDetails='Num text elements: '+textList.length+'. Language code: '+languageCode;logEvent(LogCategoryName,"Translation started",logDetails);}
async function showDesignPropertyMenu(){hideRootMenus();let designData=await getDesignData(DesignID);DesignPropertyMenu[0].contentWindow.configure(DesignID,designData.name);let menuElem=$('#rootHeader .menuName.file');showFloatingMenu(DesignPropertyMenu,menuElem);logEvent(LogCategoryName,'Showed design property menu');}
async function designPropertyMenuDidSave(designName){let user=await Db.getUser();if(!user){hideFloatingMenus();MessageClass.showModal('Please sign up or login first');return;}
Db.updateDesignName(DesignID,designName);localStorage.removeItem(LSUserDesignList);let message='Set design name to '+designName;MessageClass.showMessage(message);let logDetails='New name: '+designName;logEvent(LogCategoryName,'Design properties saved',logDetails);}
function showCollageGridMenu(toolBoxElem){let designSize=PreviewBoxContentWindow.getDesignSize();let numCells=2;let cellWidth=roundToStep(designSize.width/numCells);let cellHeight=roundToStep(designSize.height/numCells);let data=PreviewBoxContentWindow.editorWantsCollageGrid();if(data&&data.numCells){numCells=data.numCells;cellWidth=data.cellWidth;cellHeight=data.cellHeight;}
CollageGridMenu[0].contentWindow.configure(numCells,cellWidth,cellHeight);showFloatingMenu(CollageGridMenu,toolBoxElem);}
function collageGridMenuDidSetCollageGrid(numCells,cellWidth,cellHeight,gapSize){let message='Removed collage grid';if(numCells){message='Changed panorama to '+cellWidth+' x '+cellHeight+' @ '+numCells;}
MessageClass.showMessage(message);setTimeout(function(){PreviewBoxContentWindow.editorDidSetCollageGrid(numCells,cellWidth,cellHeight,gapSize);},250);}
function showSizeMenu(toolBoxElem,sizeEventType){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1||(allItems.length===1&&allItems[0].itemType===Hotpot.itemTypes.design)){return;}
SizeMenu[0].contentWindow.configure(sizeEventType);showFloatingMenu(SizeMenu,toolBoxElem);}
function sizeMenuDidSetRatioSize(ratio,eventType){var widthRatio=null;var heightRatio=null;if(eventType==Hotpot.eventTypes.size.changeWidth){widthRatio=ratio;}else{heightRatio=ratio;}
PreviewBoxContentWindow.editorDidSetRelativeSizeToDesign(widthRatio,heightRatio);setControlBox();}
function sizeMenuDidSetAbsoluteSize(width,height){setAbsoluteSize(width,height);}
function setAbsoluteSize(width,height){PreviewBoxContentWindow.editorDidSetAbsoluteSize(width,height);didResizeElem();}
function didResizeElem(){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];setControlBox();MessageClass.showMessage("Resized to "+itemData.width+"x"+itemData.height);}
function showRotationMenu(toolBoxElem){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var xValue=itemData.rotationData.xValue;RotationMenu[0].contentWindow.configure(xValue);showFloatingMenu(RotationMenu,toolBoxElem);}
function createRotationData(unit,xValue){return{unit:unit,xValue:xValue};}
function rotationMenuDidSetRotation(unit,xValue){PreviewBoxContentWindow.editorDidSetRotation(unit,xValue);setRotationPanel(createRotationData(unit,xValue));}
function showMaskMenu(){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var canvasGraphic={graphicURL:itemData.foregroundData.graphicURL,width:itemData.width,height:itemData.height}
var maskData=itemData.maskData;MaskMenu[0].contentWindow.configure(canvasGraphic,maskData);showFloatingMenuFullScreen(MaskMenu);}
function maskMenuDidSetMask(maskURL,maskWidth,maskHeight,maskX,maskY){PreviewBoxContentWindow.editorDidSetMaskData(maskURL,maskWidth,maskHeight,maskX,maskY);setMaskPanel(maskURL);}
function showBlurMenu(toolBoxElem){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var blurData=itemData.blurData;var blurLength=blurData.length;var unit=blurData.unit;BlurMenu[0].contentWindow.configure(blurLength,unit);showFloatingMenu(BlurMenu,toolBoxElem);}
function blurMenuDidSetBlur(blurLength,unit){PreviewBoxContentWindow.editorDidSetBlur(blurLength,unit);var blurData={length:blurLength,unit:unit};setBlurPanel(blurData);}
function menuWantsHistorySave(){PreviewBoxContentWindow.editorDidSetHistory();}
function showCornerMenu(toolBoxElem){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var data=itemData.cornerData;var topRadius=data.topRadius;var rightRadius=data.rightRadius;var bottomRadius=data.bottomRadius;var leftRadius=data.leftRadius;var unit=data.unit;CornerMenu[0].contentWindow.configure(itemData.width,itemData.height,topRadius,rightRadius,bottomRadius,leftRadius,unit);showFloatingMenu(CornerMenu,toolBoxElem);}
function cornerMenuDidSetRadius(topRadius,rightRadius,bottomRadius,leftRadius,unit){PreviewBoxContentWindow.editorDidSetCornerRadius(topRadius,rightRadius,bottomRadius,leftRadius,unit);var data={unit:unit,topRadius:topRadius,rightRadius:rightRadius,bottomRadius:bottomRadius,leftRadius:leftRadius};setCornerPanel(data);}
function showFilterMenu(toolBoxElem){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var shadowData=itemData.shadowData;FilterMenu[0].contentWindow.configure(shadowData.length0,shadowData.length1,shadowData.length2,shadowData.color,shadowData.unit);showFloatingMenu(FilterMenu,toolBoxElem);}
function filterMenuDidSetShadow(length0,length1,length2,color,unit){PreviewBoxContentWindow.editorDidSetShadow(length0,length1,length2,color,unit);var shadowData={length0:length0,length1:length1,length2:length2,color:color,unit:unit};setFilterPanel(shadowData);}
function showScreenshotMenu(toolBoxElem){let data=PreviewBoxContentWindow.editorWantsScreenshotData();ScreenshotMenu[0].contentWindow.configure(data.sizeRatio,data.x,data.y,data.targetWidth,data.targetHeight);showFloatingMenu(ScreenshotMenu,toolBoxElem);}
function screenshotMenuDidSetScreenshotSizeRatio(newSize){PreviewBoxContentWindow.editorDidSetScreenshotSizeRatio(newSize);}
function screenshotMenuDidSetScreenshotPosition(newPos){PreviewBoxContentWindow.editorDidSetScreenshotPosition(newPos);}
function showRepeatMenu(toolBoxElem){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
let itemData=allItems[0];RepeatMenu[0].contentWindow.configure(itemData.repeatData);showFloatingMenu(RepeatMenu,toolBoxElem);}
function repeatMenuDidSetData(isRepeating,widthRatio,xRatio,yRatio){PreviewBoxContentWindow.editorDidSetRepeatData(isRepeating,widthRatio,xRatio,yRatio);setRepeatPanel(isRepeating,widthRatio);}
function showGraphicMenu(toolBoxElem,eventType){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){MessageClass.showMessage('This menu cannot be used if multiple items are selected');return;}
var itemData=allItems[0];var canClear=false;var itemType=itemData.itemType;if(eventType==Hotpot.eventTypes.graphic.changeMask){canClear=itemData.maskData.url;}
GraphicMenu[0].contentWindow.configure(window.location.href,itemType,eventType,canClear);showFloatingMenu(GraphicMenu,null);}
function graphicMenuDidChangeGraphic(eventType,graphicData,maskData,isRepeating){var controlBoxGraphicURL=graphicData?graphicData.url:GraphicIconURL;var normalList=[Hotpot.eventTypes.graphic.createGraphic,Hotpot.eventTypes.graphic.createCallOut,Hotpot.eventTypes.graphic.createPattern,Hotpot.eventTypes.graphic.createLogo,Hotpot.eventTypes.graphic.createDivider];if(normalList.includes(eventType)){PreviewBoxContentWindow.editorDidCreateGraphic(graphicData);}else if(eventType==Hotpot.eventTypes.graphic.createDevice){PreviewBoxContentWindow.editorDidCreateDeviceGraphic(graphicData,maskData);setGraphicAndColorGrid(FramePanel,controlBoxGraphicURL,Hotpot.eventTypes.color.changeFrameGraphic);}else if(eventType==Hotpot.eventTypes.graphic.changeForeground){PreviewBoxContentWindow.editorDidSetForegroundGraphic(graphicData);setGraphicPanel(controlBoxGraphicURL);}else if(eventType==Hotpot.eventTypes.graphic.changeFrame){PreviewBoxContentWindow.editorDidSetFrameGraphic(graphicData,maskData);setGraphicAndColorGrid(FramePanel,controlBoxGraphicURL,Hotpot.eventTypes.color.changeFrameGraphic);setScreenshotSize(true);}else if(eventType==Hotpot.eventTypes.graphic.changeMask){PreviewBoxContentWindow.editorDidSetMaskGraphic(graphicData);setMaskPanel(controlBoxGraphicURL);}else{debugError("Error updating graphic: unknown event. Event type: "+eventType);}}
function showColorMenu(controlBoxElem,type){var color=null;if(!controlBoxElem.hasClass("transparent")){color=controlBoxElem.css("background-color");var imageString=controlBoxElem.css("background-image");if(imageString&&imageString.includes("gradient")){color=imageString;}}
ColorMenu[0].contentWindow.configure(color,type);showFloatingMenu(ColorMenu,controlBoxElem);}
function colorMenuDidChangeColor(newColor,colorEventType,updateHistory){if(colorEventType==null){debugError("Error changing color: no color event type.");return;}
var newGraphicURL=null;if(colorEventType==Hotpot.eventTypes.color.changeBackground){PreviewBoxContentWindow.editorDidSetBackgroundColor(newColor);setControlBoxColor(BackgroundPanel.find(".primary.color"),newColor);}else if(colorEventType==Hotpot.eventTypes.color.changeText){setControlBoxColor(TextPanel.find(".color"),newColor);PreviewBoxContentWindow.editorDidSetTextColor(newColor);}else if(colorEventType==Hotpot.eventTypes.color.changeForegroundGraphic){newGraphicURL=PreviewBoxContentWindow.editorDidSetGraphicColor(colorEventType,LastColorClassID,newColor);didSetGraphicColor(GraphicPanel,newGraphicURL,newColor);}else if(colorEventType==Hotpot.eventTypes.color.changeFrameGraphic){newGraphicURL=PreviewBoxContentWindow.editorDidSetGraphicColor(colorEventType,LastColorClassID,newColor);didSetGraphicColor(FramePanel,newGraphicURL,newColor);}
if(updateHistory){PreviewBoxContentWindow.editorDidSetHistory();}}
function fontMenuDidChangeFont(font){TextPanel.find(".fontFamily").text(font.family);didChangeFont(TextPanel,font);}
function fontMenuDidClickLanguageButton(language){logEvent(LogCategoryName,'Font Language Button Clicked: '+language);}
function fontMenuDidClickAsianButton(){logEvent(LogCategoryName,'Asian Font Button Clicked',);}
function fontMenuDidClickArabicButton(){logEvent(LogCategoryName,'Arabic Font Button Clicked',);}
function showFontMenu(elem){FontMenu[0].contentWindow.configure();showFloatingMenu(FontMenu,elem);}
function setScreenshotPanel(graphicUrl,verifySize){ScreenshotPanel.find('.graphic img').attr('src',graphicUrl);ScreenshotPanel.find('.graphic').toggleClass('transparent',!graphicUrl);setScreenshotSize(verifySize);}
function setScreenshotSize(verifySize){let screenshotData=PreviewBoxContentWindow.editorWantsScreenshotData();let targetWidth=screenshotData.targetWidth;let targetHeight=screenshotData.targetHeight;if(!targetWidth||!targetHeight){return;}
ScreenshotPanel.find('.width').text(targetWidth);ScreenshotPanel.find('.height').text(targetHeight);if(verifySize){let imageUrl=ScreenshotPanel.find('.graphic img').attr('src');getImageSize(imageUrl,function(imageWidth,imageHeight){let actualAspectRatio=imageWidth/imageHeight;let targetAspectRatio=targetWidth/targetHeight;ScreenshotPanel.find('.warning').toggle(targetAspectRatio!==actualAspectRatio);});}}
function didSetGraphicColor(panel,newURL,newColor){panel.find(".graphic img").attr("src",newURL);panel.find("[data-color-class-id='"+LastColorClassID+"']").css("background",newColor);}
function setGraphicPanel(graphicURL){setGraphicAndColorGrid(GraphicPanel,graphicURL,Hotpot.eventTypes.color.changeForegroundGraphic);}
function setGraphicAndColorGrid(panel,graphicURL,eventType){panel.find(".graphic img").attr("src",graphicURL);setColorGrid(panel,eventType);}
function setColorGrid(panel,colorEventType){const colorGrid=panel.find(".colorGrid");const colorListPromise=PreviewBoxContentWindow.editorWantsColorListPromise(colorEventType);colorListPromise.then(function(colorList){colorGrid.find(".secondary").remove();var colorListIDs=Object.keys(colorList);$.each(colorListIDs,function(i,id){var color=colorList[id];var colorElem=$(document.createElement("div"));colorElem.addClass("secondary color");colorElem.css("background",color);colorElem.attr("data-color-class-id",id);colorGrid.append(colorElem);});},function(){colorGrid.find(".secondary").remove();});}
function didChangeFont(panel,fontFallback){var font={family:panel.find(".fontFamily").text(),weight:parseInt(panel.find(".fontWeightMenu").val(),10),style:panel.find(".italic").hasClass("selected")?"italic":"normal"};var hasNeededItalic=setItalicButton(panel,font);var hasWeight=setFontWeightMenu(panel,font);if(!(hasWeight&&hasNeededItalic)&&fontFallback){font=fontFallback;setItalicButton(panel,font);setFontWeightMenu(panel,font);}
PreviewBoxContentWindow.editorDidSetTextProperty("font",font);}
function setFontWeightMenu(panel,font){var fontWeightMenu=panel.find(".fontWeightMenu");fontWeightMenu.find(".weight").hide();var hasWeight=false;var weights=FontMenu[0].contentWindow.getWeights?FontMenu[0].contentWindow.getWeights(font):[];weights.forEach(function(value){var option=fontWeightMenu.find(".weight[value='"+value+"']");option.show();if(font.weight==value){fontWeightMenu.val(value);hasWeight=true;}});return hasWeight;}
function setItalicButton(panel,font){var italicButton=panel.find(".italic");var tooltip="Italic";italicButton.removeClass("disabled selected");var hasItalic=FontMenu[0].contentWindow.hasItalic?FontMenu[0].contentWindow.hasItalic(font):false;if(!hasItalic){italicButton.addClass("disabled");tooltip="Italic not available for this font";}else if(font.style==="italic"){italicButton.addClass("selected");}
italicButton.attr("title",tooltip);return hasItalic||font.style!=="italic";}
function getTextPanelFor(id){if(typeof id!=="string"){id=id.attr("id");}
return TextPanelContainer.children("#"+TextPanelPrefix+id);}
function addTextPanel(id,jQuery){var panelString=$("#textpanel-template").html();var panel=jQuery(panelString);panel.attr("id",TextPanelPrefix+id);var buttonHandlers={font:function(){showFontMenu(panel.find(".fontFamilyBox"));},color:function(){showColorMenu(panel.find(".color"),Hotpot.eventTypes.color.changeText);}};var valueHandlers={font:function(item,value){var panel=getTextPanelFor(item);panel.find(".fontFamily").text(value.family);setFontWeightMenu(panel,value);setItalicButton(panel,value);},size:function(item,value){var convertedFontSize=pixelStringToInt(value);getTextPanelFor(item).find(".fontSize").val(convertedFontSize);},letterspacing:function(item,value){var letterSpacingValue=value.replace(/em/g,"");if(letterSpacingValue==="normal"){letterSpacingValue=0;}
var panel=getTextPanelFor(item);panel.find(".letterSpacing .slider").val(letterSpacingValue);panel.find(".letterSpacing .output").html(letterSpacingValue);},color:function(item,value){var button=getTextPanelFor(item).find(".color");setControlBoxColor(button,value);},lineheight:function(item,value){var panel=getTextPanelFor(item);panel.find(".lineHeight .slider").val(value);panel.find(".lineHeight .output").html(value);}};TextPanelContainer.append(panel);panel.hide();initTextPanelEvents(panel);debug("Init text panel");return{panel:panel,buttonHandlers:buttonHandlers,valueHandlers:valueHandlers};}
function setControlBox(hideMenus=true){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();var firstItem=allItems.length>0?allItems[0]:null;if(!firstItem){debugError("Error setting control box. No items selected");return;}
var itemType=firstItem.itemType;if(itemType!=Hotpot.itemTypes.design&&itemType!=Hotpot.itemTypes.text&&itemType!=Hotpot.itemTypes.graphic){debugError("Error setting control box. Unrecognized class. Data: "+firstItem);return;}
if(hideMenus){hideRootMenus();}
ActionBox.show();SizePanel.show();RotationPanel.show();MirrorPanel.show();FilterPanel.show();BlurPanel.show();OpacityPanel.show();TextPanelContainer.children().hide();GraphicPanel.hide();ScreenshotPanel.hide();FramePanel.hide();LandscapePanel.hide();BackgroundPanel.hide();RepeatPanel.hide();CornerPanel.hide();MaskPanel.hide();CollageGridPanel.hide();GroupAlignmentBox.hide();GroupSpaceBox.hide();if(allItems.length>1){GroupAlignmentBox.show();GroupSpaceBox.show();GroupSpaceBox.toggleClass("disabled",allItems.length<3);SizePanel.hide();RotationPanel.hide();MirrorPanel.hide();FilterPanel.hide();BlurPanel.hide();OpacityPanel.hide();}else if(firstItem.itemType==Hotpot.itemTypes.design){CollageGridPanel.show();BackgroundPanel.show();RotationPanel.hide();ActionBox.hide();MirrorPanel.hide();FilterPanel.hide();BlurPanel.hide();OpacityPanel.hide();}else if(firstItem.itemType==Hotpot.itemTypes.text){SizePanel.hide();TextPanel=TextPanelContainer.children("#"+TextPanelPrefix+firstItem.itemID);TextPanel.show();}else if(firstItem.frameData&&firstItem.frameData.graphic){ScreenshotPanel.show();FramePanel.show();setScreenshotPanel(firstItem.foregroundData.graphicURL,false);setFramePanel(firstItem.frameData);LandscapePanel.toggle(firstItem.canSetOrientation);setLandscapePanel(firstItem.isLandscape);toggleScreenshotTutorial(true);}else if(firstItem.itemType==Hotpot.itemTypes.graphic){GraphicPanel.show();RepeatPanel.show();CornerPanel.show();MaskPanel.show();setGraphicPanel(firstItem.foregroundData.graphicURL);}
if(allItems.length===1){setItemTreePanel(firstItem);setBackgroundPanel(firstItem.backgroundData);setRotationPanel(firstItem.rotationData);setRepeatPanel(firstItem.repeatData.isRepeating,firstItem.repeatData.widthRatio);setFilterPanel(firstItem.shadowData);setBlurPanel(firstItem.blurData);setOpacityPanel(firstItem.opacityData);setMaskPanel(firstItem.maskData.url);setCornerPanel(firstItem.cornerData);setSizePanel(firstItem);setMirrorPanel(firstItem.isMirror);setCollageGridPanel(firstItem.collageGridData);}}
function toggleScreenshotTutorial(turnOn){var keyName=TutorialClass.KeyList.editor.screenshot;var screenshotElement=ScreenshotPanel.find(".graphicAndColorSet .graphic");if(turnOn){screenshotElement.toggleClass("screenshotAnimation",!TutorialClass.didSee(keyName));}else{screenshotElement.removeClass("screenshotAnimation");TutorialClass.setTutorial(keyName,true);}}
function setCollageGridPanel(data){var summary="&mdash;";if(data&&data.numCells){summary=data.cellWidth+" x "+data.cellHeight+" @ "+data.numCells;}
CollageGridPanel.find(".summary").html(summary);}
function setItemTreePanel(itemData){var label="";var type=itemData.itemType;if(type===Hotpot.itemTypes.design){label="Canvas";}else if(type===Hotpot.itemTypes.graphic){ItemTreePanel.find("img").attr("src",itemData.foregroundData.graphicURL);}else if(type===Hotpot.itemTypes.text){label=itemData.foregroundData.text;}
ItemTreePanel.find(".label").html(label);ItemTreePanel.find("img").toggle(type===Hotpot.itemTypes.graphic);ItemTreePanel.find(".label").toggle(type!==Hotpot.itemTypes.graphic);}
function setSizePanel(itemData){var widthString=itemData.width;var heightString=itemData.height;SizePanel.find(".width").val(widthString);SizePanel.find(".height").val(heightString);var aspectRatioIcon=SizePanel.find(".button.aspectRatio");aspectRatioIcon.toggle(itemData.canChangeAspectRatio);aspectRatioIcon.toggleClass("selected",itemData.preserveAspectRatio);}
function initTextPanelEvents(panel){panel.find(".fontWeightMenu").on("change",function(){didChangeFont(panel);});panel.find(".italic").on("click",function(){$(this).toggleClass("selected");didChangeFont(panel);});panel.find(".fontSize").on("change",function(){var newSize=$(this).val()+"px";PreviewBoxContentWindow.editorDidSetTextProperty("size",newSize);});panel.find(".lineHeight .slider").on("input",function(){var value=$(this).prop("valueAsNumber");$(this).closest(".lineHeight").find(".output").html(value);PreviewBoxContentWindow.editorDidSetTextProperty("lineheight",value);});panel.find(".letterSpacing .slider").on("input",function(){var value=$(this).val();var valueAndUnit=value+"em";$(this).closest(".letterSpacing").find(".output").html(value);PreviewBoxContentWindow.editorDidSetTextProperty("letterspacing",valueAndUnit);});}
function setMenuValue(menu,value){let options=menu.find('option');options.each(function(i,entry){let optionValue=$(entry).val()
let matchesValue=false;if($.isNumeric(value)){matchesValue=optionValue==value;}else if(value){matchesValue=optionValue.toLowerCase()==value.toLowerCase();}
if(i==0){menu.val(optionValue);}else if(matchesValue){menu.val(value);}});debug("Set menu for "+printName(menu)+". Requested value: "+value+". New value: "+menu.val())}
function createSelectOption(value,html){var newOption=$(document.createElement("option"));newOption.attr("value",value);newOption.html(html);return newOption}
function getFontFamilyOptions(){var fontListString="Anton|Arvo|Comfortaa|Fredoka+One|Gloria+Hallelujah|Indie+Flower|Karla|Lato|Lobster|Luckiest+Guy|Merriweather|Mukta|Nanum+Gothic|Noto+Sans|Open+Sans|Oswald|Oxygen|PT+Sans|PT+Sans+Narrow|Permanent+Marker|Playfair+Display|Pontano+Sans|Raleway|Righteous|Roboto|Roboto+Condensed|Roboto+Mono|Rubik|Shadows+Into+Light|Source+Sans+Pro|Ubuntu|Ultra";var families=[];var fontDelimiter="|"
var splitFonts=fontListString.split(fontDelimiter);splitFonts.forEach(function(entry){var parsedFamily=entry.replace(/\+/g," ");families.push(parsedFamily)});var options=[];families.forEach(function(entry){var newOption=createSelectOption(entry,entry)
options.push(newOption);});return options;}
function getSpaceBeforeOptions(){var values=["0.8","1.0","1.2","1.4","1.6","1.8","2.0","2.2"];var options=[];values.forEach(function(entry){var newOption=createSelectOption(entry+"em",entry+" em")
options.push(newOption);});return options;}
function sizePanelInputDidBlur(input){var allItems=PreviewBoxContentWindow.editorWantsAllSelectedItems();if(allItems.length!==1){return;}
var itemData=allItems[0];var sizeEventType=input.hasClass("width")?Hotpot.eventTypes.size.changeWidth:Hotpot.eventTypes.size.changeHeight;var oldWidth=itemData.width;var oldHeight=itemData.height;var oldValue=sizeEventType==Hotpot.eventTypes.size.changeWidth?oldWidth:oldHeight;var value=input.val();if(value!=oldValue){if(isInteger(value)&&value>0){sizePanelInputDidChangeValue(value,sizeEventType);}else{input.val(oldValue);MessageClass.showMessage("Please use whole numbers. Thanks!");}}}
function sizePanelInputDidChangeValue(value,eventType){var newWidth=eventType==Hotpot.eventTypes.size.changeWidth?value:null;var newHeight=eventType==Hotpot.eventTypes.size.changeHeight?value:null;PreviewBoxContentWindow.editorDidSetAbsoluteSize(newWidth,newHeight);didResizeElem();}
function initControlBox(){loadFloatingMenu(ItemTreeMenu).then(initItemTreePanel);initSizePanel();var colorMenuPromise=loadFloatingMenu(ColorMenu);var graphicMenuPromise=loadFloatingMenu(GraphicMenu).then(initGraphicPanel);$.when(graphicMenuPromise,colorMenuPromise).then(initFramePanel);initLandscapePanel();initMirrorPanel();loadFloatingMenu(CollageGridMenu).then(initCollageGridPanel);loadFloatingMenu(TranslateMenu);loadFloatingMenu(DesignPropertyMenu);$.when(graphicMenuPromise,colorMenuPromise).then(initBackgroundPanel);let screenshotMenuPromise=loadFloatingMenu(ScreenshotMenu);$.when(screenshotMenuPromise,graphicMenuPromise).then(initScreenshotPanel);loadFloatingMenu(RotationMenu).then(initRotationPanel);loadFloatingMenu(FilterMenu).then(initFilterPanel);loadFloatingMenu(BlurMenu).then(initBlurPanel);initOpacityPanel();loadFloatingMenu(MaskMenu).then(initMaskPanel);loadFloatingMenu(RepeatMenu).then(initRepeatPanel);loadFloatingMenu(CornerMenu).then(initCornerPanel);loadFloatingMenu(FontMenu);ControlBox.on("click",function(){hideRootMenus();});}
function initItemTreePanel(){ItemTreePanel.on("click",function(){showItemTreeMenu($(this));});}
function initRotationPanel(){RotationPanel.find(".summary").on("click",function(){showRotationMenu($(this));});}
function initFilterPanel(){FilterPanel.find(".color").on("click",function(){showFilterMenu($(this));});}
function initBlurPanel(){BlurPanel.find(".summary").on("click",function(){showBlurMenu($(this));});}
function initOpacityPanel(){OpacityPanel.find(".slider").on("input",function(){didSetOpacitySlider($(this));});OpacityPanel.find(".slider").on("blur",function(){PreviewBoxContentWindow.editorDidSetHistory();});}
function initMaskPanel(){MaskPanel.find(".graphic").on("click",function(){showMaskMenu();});}
function initRepeatPanel(){RepeatPanel.find(".summary").on("click",function(){showRepeatMenu($(this));});}
function initCornerPanel(){CornerPanel.find(".summary").on("click",function(){showCornerMenu($(this));});}
function initScreenshotPanel(){ScreenshotPanel.find("input.file").on("change",function(){didUploadScreenshot($(this));});ScreenshotPanel.find(".graphic").on("click",function(){ScreenshotPanel.find("input.file").trigger("click");toggleScreenshotTutorial(false);});ScreenshotPanel.find(".position").on("click",function(){showScreenshotMenu($(this));});}
function didUploadScreenshot(fileControl){var domFileControl=fileControl[0];if(domFileControl.files&&domFileControl.files[0]){var firstFile=domFileControl.files[0];var reader=new FileReader();reader.onload=function(e){var imageURL=reader.result;getImageSize(imageURL,function(imageWidth,imageHeight){var graphicData=Hotpot.newGraphic(imageURL,imageWidth,imageHeight);PreviewBoxContentWindow.editorDidSetFrameContent(graphicData);setScreenshotPanel(imageURL,true);});clearUploadedFilepath(fileControl);};reader.readAsDataURL(firstFile);debug("Uploaded image: "+firstFile.name);}}
function clearUploadedFilepath(fileControl){if(fileControl.val()){fileControl.val("");}}
function initFramePanel(){FramePanel.find(".graphic").on("click",function(){showGraphicMenu($(this),Hotpot.eventTypes.graphic.changeFrame);});FramePanel.on("click",".color",function(){didClickColorGridColor($(this),Hotpot.eventTypes.color.changeFrameGraphic);});}
function initLandscapePanel(){LandscapePanel.find(".switch").on("change",function(){PreviewBoxContentWindow.editorDidSetFrameOrientation($(this).prop("checked"));setScreenshotSize(true);});}
function initCollageGridPanel(){CollageGridPanel.find(".summary").on("click",function(){showCollageGridMenu($(this));});}
function initMirrorPanel(){MirrorPanel.find('.switch').on('change',function(){PreviewBoxContentWindow.editorDidSetMirrorTransform($(this).prop('checked'));});}
function initBackgroundPanel(){BackgroundPanel.find(".primary.color").on("click",function(){showColorMenu($(this),Hotpot.eventTypes.color.changeBackground);});}
function initSizePanel(){SizePanel.find('.size').on('click',function(){let selectedClass='selected';deselectSizePanelInputs(selectedClass);$(this).addClass(selectedClass)
let sizeEventType=$(this).hasClass('width')?Hotpot.eventTypes.size.changeWidth:Hotpot.eventTypes.size.changeHeight;});SizePanel.find('.size').on('blur',function(){$(this).removeClass('selected');});SizePanel.find('.size').on('change',function(){sizePanelInputDidBlur($(this));});SizePanel.find('.button.aspectRatio').on('click',function(){let className='selected';$(this).toggleClass(className);PreviewBoxContentWindow.editorDidSetAspectRatio($(this).hasClass(className));});}
function initGraphicPanel(){GraphicPanel.find(".graphic").on("click",function(){showGraphicMenu($(this),Hotpot.eventTypes.graphic.changeForeground);});GraphicPanel.on("click",".color",function(){didClickColorGridColor($(this),Hotpot.eventTypes.color.changeForegroundGraphic);});}
function didClickColorGridColor(colorElem,colorEventType){LastColorClassID=$(colorElem).attr("data-color-class-id");showColorMenu($(colorElem),colorEventType);}
async function deliverFiles(newId){setDesignId(newId);let newWindow=openDownloadWindow();if(!newWindow||newWindow.closed||typeof newWindow.closed=="undefined"){showDownloadModal();}
try{await saveDesign();startDownload();}catch(error){didFailOnSave(error);}
logEvent(LogCategoryName,'Delivery started: '+DesignID,);}
function openDownloadWindow(){let newWindow=window.open(getDownloadUrl(),getDownloadWindowName(DesignID));return newWindow;}
function getDownloadUrl(){let rootUrl='/download';let queryString='?id='+DesignID+'&email='+UserEmailAddress;let downloadUrl=rootUrl+queryString;return downloadUrl;}
function getDownloadWindowName(id){return 'HotpotDownload-'+id;}
function startDownload(){let delayDur=2000;if(!DownloadWindow||!DownloadWindow.startDownload){setTimeout(startDownload,delayDur);return;}
let sliceList=collageGridToDesignSliceList();DownloadWindow.startDownload(sliceList);DownloadWindow=null;logEvent(LogCategoryName,'Download started: '+DesignID,);}
function collageGridToDesignSliceList(){var sliceList=[];var data=PreviewBoxContentWindow.editorWantsCollageGrid();if(data&&data.numCells){var xDelta=data.cellWidth+data.gapSize;for(var i=0;i<data.numCells;i++){var slice={x:xDelta*i,y:0,width:data.cellWidth,height:data.cellHeight};sliceList.push(slice);}}
return sliceList;}
async function convertToTemplate(){let newId=createDesignId();openTemplateWindow(newId);try{await saveDesign(newId);startDownload();}catch(error){didFailOnSave(error);}}
function openTemplateWindow(id){let rootURL='/download';let queryString='?id='+id+'&admin=208&fileType=jpg&categoryID=';let templateURL=rootURL+queryString;DownloadWindow=window.open(templateURL,'_blank');}
function openLoginWindow(){let queryString='?s=editor-menu';if(UserEmailAddress){queryString+=`&email=${UserEmailAddress}`}
window.open('/login'+queryString,'_blank');}
function didFailOnSave(error){let details=error&&error.message?error.message:'None';let message=`
      <p> So sorry! </p>

      <p> We had a hiccup saving this design. If you contact us, we will offer free designs as an apology. </p>
   `;message=message+'<p> Design ID: '+DesignID+'</p>';message=message+'<p> Details: '+details+'</p>';MessageClass.showModal(message);}
function createDesignId(){let id=createAlphanumericString(12);let designSize=PreviewBoxContentWindow.getDesignSize();id=id+'_'+designSize.width+'_'+designSize.height;return id;}
async function saveDesign(saveDesignIdParam){let promise=$.Deferred();let saveDesignId=saveDesignIdParam?saveDesignIdParam:DesignID;IsDirty=false;toggleSaveMessageBox(true);let serializedDoc=PreviewBoxContentWindow.editorWantsDesignString();try{await saveToDatabase(saveDesignId,serializedDoc);promise.resolve();}catch(error){IsDirty=true;promise.reject(error);}finally{toggleSaveMessageBox(false);}
debug('Saving design on server: '+saveDesignId);logEvent(LogCategoryName,'Design saved. ID: '+saveDesignId,);return promise;}
function toggleSaveMessageBox(show){if(show){$('#saveMessageBox').fadeIn();}else{$('#saveMessageBox').fadeOut();}}
function setSaveMessageText(text){$('#saveMessageBox .message').text(text);}
function autoSaveDesign(){if(location.hostname&&(location.hostname.includes('staging.hotpot')||!location.hostname.includes('hotpot'))){return;}
let saveDur=1000*300;setTimeout(async function(){if(IsDirty){await saveDesign();}
autoSaveDesign();},saveDur);}
function replaceTemplate(){uploadTemplate(true);}
function uploadTemplate(reuseID){let urlPath=window.location.pathname;let categoryID=urlPath.split('/').slice(-1).pop();let templateID=reuseID?getURLParameter('id'):null;let serializedDoc=PreviewBoxContentWindow.editorWantsDesignString();$.post('/admin/uploadDesignTemplate',{templateID:templateID,categoryID:categoryID,designDoc:serializedDoc}).done(function(result){debug('Success! '+result.statusMessage);}).fail(function(result){alert('Error uploading template: '+result.statusMessage);});MessageClass.showMessage('Uploading design. Category ID: '+categoryID+'. Template ID: '+templateID);}
function toggleFullSizeView(show){if(window.drift&&drift.api&&show){drift.api.widget.hide();}
var fadeDur=300;if(!show){FullSizeBox.fadeOut(fadeDur,function(){FullSizeBox.hide();});$("body").css("overflow","hidden");window.scrollTo(0,0);}else{$("body").css("overflow","visible");var fullSizeBoxIFrame=FullSizeBox.find("iframe");var fullSizeBoxHead=$(fullSizeBoxIFrame[0].contentDocument.head);var fullSizeBoxBody=$(fullSizeBoxIFrame[0].contentDocument.body);fullSizeBoxBody.empty();var designSize=PreviewBoxContentWindow.getDesignSize();fullSizeBoxIFrame.width(designSize.width);fullSizeBoxIFrame.height(designSize.height);FullSizeBox.height(designSize.height);var previewDoc=$(PreviewBoxContentWindow.document);var previewHeadStyles=previewDoc.find("head link, head style").clone();var previewBodyStyles=previewDoc.find("body style").clone();var designBoxClone=PreviewBoxContentWindow.getDesignBoxDOM(true);fullSizeBoxHead.append(previewHeadStyles);fullSizeBoxBody.append(previewBodyStyles);fullSizeBoxBody.append(designBoxClone);FullSizeBox.fadeIn(fadeDur);}}
function initGroupAlignmentBox(){GroupAlignmentBox.on("click",".button.alignLeft",function(){groupAlignmentBoxDidAlignLeft();});GroupAlignmentBox.on("click",".button.alignHorizontalCenter",function(){groupAlignmentBoxDidAlignHorizontalCenter();});GroupAlignmentBox.on("click",".button.alignRight",function(){groupAlignmentBoxDidAlignRight();});GroupAlignmentBox.on("click",".button.alignTop",function(){groupAlignmentBoxDidAlignTop();});GroupAlignmentBox.on("click",".button.alignVerticalCenter",function(){groupAlignmentBoxDidAlignVerticalCenter();});GroupAlignmentBox.on("click",".button.alignBottom",function(){groupAlignmentBoxDidAlignBottom();});}
function groupAlignmentBoxDidAlignLeft(){PreviewBoxContentWindow.editorDidGroupAlignLeft();}
function groupAlignmentBoxDidAlignHorizontalCenter(){PreviewBoxContentWindow.editorDidGroupAlignHorizontalCenter();}
function groupAlignmentBoxDidAlignRight(){PreviewBoxContentWindow.editorDidGroupAlignRight();}
function groupAlignmentBoxDidAlignTop(){PreviewBoxContentWindow.editorDidGroupAlignTop();}
function groupAlignmentBoxDidAlignVerticalCenter(){PreviewBoxContentWindow.editorDidGroupAlignVerticalCenter();}
function groupAlignmentBoxDidAlignBottom(){PreviewBoxContentWindow.editorDidGroupAlignBottom();}
function initGroupSpaceBox(){GroupSpaceBox.on("click",".button.spaceLeft",function(){groupSpaceBoxDidSpaceLeft();});GroupSpaceBox.on("click",".button.spaceHorizontalCenter",function(){groupSpaceBoxDidSpaceHorizontalCenter();});GroupSpaceBox.on("click",".button.spaceRight",function(){groupSpaceBoxDidSpaceRight();});GroupSpaceBox.on("click",".button.spaceTop",function(){groupSpaceBoxDidSpaceTop();});GroupSpaceBox.on("click",".button.spaceVerticalCenter",function(){groupSpaceBoxDidSpaceVerticalCenter();});GroupSpaceBox.on("click",".button.spaceBottom",function(){groupSpaceBoxDidSpaceBottom();});GroupSpaceBox.on("click",".button.spaceHorizontalEvenly",function(){groupSpaceBoxDidSpaceHorizontalEvenly();});GroupSpaceBox.on("click",".button.spaceVerticalEvenly",function(){groupSpaceBoxDidSpaceVerticalEvenly();});}
function groupSpaceBoxDidSpaceLeft(){PreviewBoxContentWindow.editorDidGroupSpaceLeft();}
function groupSpaceBoxDidSpaceHorizontalCenter(){PreviewBoxContentWindow.editorDidGroupSpaceHorizontalCenter();}
function groupSpaceBoxDidSpaceRight(){PreviewBoxContentWindow.editorDidGroupSpaceRight();}
function groupSpaceBoxDidSpaceTop(){PreviewBoxContentWindow.editorDidGroupSpaceTop();}
function groupSpaceBoxDidSpaceVerticalCenter(){PreviewBoxContentWindow.editorDidGroupSpaceVerticalCenter();}
function groupSpaceBoxDidSpaceBottom(){PreviewBoxContentWindow.editorDidGroupSpaceBottom();}
function groupSpaceBoxDidSpaceHorizontalEvenly(){PreviewBoxContentWindow.editorDidGroupSpaceHorizontalEvenly();}
function groupSpaceBoxDidSpaceVerticalEvenly(){PreviewBoxContentWindow.editorDidGroupSpaceVerticalEvenly();}
function initActionBox(){ActionBox.on("click",".button.moveBackward",function(){actionBoxDidMoveBackward();});ActionBox.on("click",".button.moveForward",function(){actionBoxDidMoveForward();});ActionBox.on("click",".button.moveToBack",function(){actionBoxDidMoveToBack();});ActionBox.on("click",".button.moveToFront",function(){actionBoxDidMoveToFront();});ActionBox.on("click",".button.copy",function(){actionBoxDidCopyItem();});ActionBox.on("click",".button.delete",function(){actionBoxDidDeleteItem();});}
function actionBoxDidDeleteItem(){deleteSelectedItems();}
function actionBoxDidCopyItem(){PreviewBoxContentWindow.editorDidCopyItems();}
function actionBoxDidMoveBackward(){PreviewBoxContentWindow.editorDidMoveItemsBackward();}
function actionBoxDidMoveForward(){PreviewBoxContentWindow.editorDidMoveItemsForward();}
function actionBoxDidMoveToBack(){PreviewBoxContentWindow.editorDidMoveItemsToBack();}
function actionBoxDidMoveToFront(){PreviewBoxContentWindow.editorDidMoveItemsToFront();}
function initZoomBox(){ZoomBox.find(".curScale").on("click",function(){didClickFullSizeButton();});ZoomBox.find(".zoomIn.button").on("click",function(){zoomBoxDidChangeScale(true);});ZoomBox.find(".zoomOut.button").on("click",function(){zoomBoxDidChangeScale(false);});ZoomBox.find(".viewFullSize.button").on("click",function(){didClickFullSizeButton();});ZoomBox.find(".fitToScreen.button").on("click",function(){didClickFitToScreenButton();});}
function didClickFullSizeButton(){toggleFullSizeView(true);logEvent(LogCategoryName,'Viewed full size. Design ID: '+DesignID);}
function zoomBoxDidChangeScale(didIncrease){var curScale=PreviewBoxContentWindow.editorWantsDesignScale();var maxScale=PreviewBoxContentWindow.editorWantsMaxDesignScale();var minScale=PreviewBoxContentWindow.editorWantsMinDesignScale();var numChunks=5;var chunkAmount=(maxScale-minScale)/numChunks;var delta=chunkAmount;if(!didIncrease){delta=-delta;}
var newScale=curScale+delta;if(curScale>1&&!didIncrease&&newScale<1){newScale=0.9;}else if(curScale<1&&didIncrease&&newScale>1){newScale=1.1;}
var numShakes=1;if(newScale<minScale){newScale=minScale
shakeItem(ZoomBox,numShakes);}else if(newScale>maxScale){newScale=maxScale;shakeItem(ZoomBox,numShakes);}
PreviewBoxContentWindow.editorDidSetDesignScale(newScale);setZoomBoxButtons();}
function setZoomBoxButtons(){var numDigits=5;var curScale=parseFloat(PreviewBoxContentWindow.editorWantsDesignScale().toFixed(numDigits));var maxScale=parseFloat(PreviewBoxContentWindow.editorWantsMaxDesignScale().toFixed(numDigits));var minScale=parseFloat(PreviewBoxContentWindow.editorWantsMinDesignScale().toFixed(numDigits));ZoomBox.find(".zoomIn.button").toggleClass("disabled",curScale==maxScale);ZoomBox.find(".fitToScreen.button").toggleClass("disabled",curScale==maxScale);ZoomBox.find(".zoomOut.button").toggleClass("disabled",curScale==minScale);}
function shakeItem(item,count){var shakeDelta=5;var shakeDur=60;$(item).animate({left:'+='+shakeDelta},shakeDur).animate({left:'-='+2*shakeDelta},2*shakeDur).animate({left:'+='+shakeDelta},shakeDur,function(){if(count>0){shakeItem(item,count-1);}});}
function didClickFitToScreenButton(){var maxScale=PreviewBoxContentWindow.editorWantsMaxDesignScale();PreviewBoxContentWindow.editorDidSetDesignScale(maxScale);setZoomBoxButtons();}
function initMenuBox(){MenuBox.find(".button.text").on("click",function(event){PreviewBoxContentWindow.editorDidCreateText();});MenuBox.find(".button.graphic").on("click",function(event){createGraphic();});MenuBox.find(".button.deviceGraphic").on("click",function(event){createDeviceGraphic();});MenuBox.find(".button.pattern").on("click",function(event){createPatternGraphic();});MenuBox.find(".button.callOut").on("click",function(event){createCallOutGraphic();});MenuBox.find(".button.divider").on("click",function(event){createDividerGraphic();});MenuBox.find(".button.undo").on("click",function(event){undo(false);});MenuBox.find(".button.snap").on("click",function(event){PreviewBoxContentWindow.editorDidToggleIsSnapping();});MenuBox.find(".button.logo").on("click",function(event){createLogoGraphic();});setUndoButton();setSnapButton(PreviewBoxContentWindow.editorAsksIsSnapping());}
function undo(selectDesign){TextPanelContainer.empty();PreviewBoxContentWindow.editorDidUndo(selectDesign);}
function setUndoButton(){var numEntries=PreviewBoxContentWindow.editorWantsDesignHistoryLength();MenuBox.find(".undo.button").toggleClass("disabled",numEntries<=1);}
function createGraphic(){var toolBoxElem=GraphicPanel.find(".graphic");showGraphicMenu(toolBoxElem,Hotpot.eventTypes.graphic.createGraphic);}
function createDeviceGraphic(){var toolBoxElem=GraphicPanel.find(".graphic");showGraphicMenu(ControlBox,Hotpot.eventTypes.graphic.createDevice);}
function createPatternGraphic(){showGraphicMenu(ControlBox,Hotpot.eventTypes.graphic.createPattern);}
function createCallOutGraphic(){showGraphicMenu(ControlBox,Hotpot.eventTypes.graphic.createCallOut);}
function createDividerGraphic(){showGraphicMenu(ControlBox,Hotpot.eventTypes.graphic.createDivider);}
function createLogoGraphic(){showGraphicMenu(ControlBox,Hotpot.eventTypes.graphic.createLogo);}
function setSnapButton(enabled){var selectedClass="selected";var button=MenuBox.find(".button.snap");if(enabled){button.addClass(selectedClass);}else{button.removeClass(selectedClass);}}
function createBlankCanvas(){TextPanelContainer.empty();TextPanel=null;PreviewBoxContentWindow.editorDidCreateCanvas();setDesignId(null);let message='Created blank canvas';MessageClass.showMessage(message);logEvent(LogCategoryName,'Created blank canvas');}
function deleteSelectedItems(){PreviewBoxContentWindow.editorDidDeleteSelectedItems();}
function initKeyboardEvents(){$(document).keydown(function(event){didKeyboardEvent(event);});}
function didKeyboardEvent(event){if(didPressMetaKey1(event)&&event.keyCode===71){event.preventDefault();createGraphic();}
if(didPressMetaKey1(event)&&event.keyCode===84){event.preventDefault();PreviewBoxContentWindow.editorDidCreateText();}
if(didPressMetaKey1(event)&&event.keyCode===90){undo(false);}
if(didPressMetaKey1(event)&&event.keyCode===68){didClickDownloadButton();}
if(didPressMetaKey1(event)&&event.keyCode===65){event.preventDefault();PreviewBoxContentWindow.editorDidSelectAllItems();}
if(didPressMetaKey1(event)&&(event.keyCode===8||event.keyCode===46)){event.preventDefault();createBlankCanvas();}
if(didPressMetaKey1(event)&&event.keyCode===13){event.preventDefault();didClickFullSizeButton();}
if(didPressMetaKey1(event)&&event.keyCode===187){event.preventDefault();zoomBoxDidChangeScale(true);}
if(didPressMetaKey1(event)&&event.keyCode===189){event.preventDefault();zoomBoxDidChangeScale(false);}
if(event.keyCode===27){if($('.floatingMenu, .rootMenu, #fullSizeBox').is(':visible')){hideRootMenus();hideFloatingMenus();toggleFullSizeView(false);}else{PreviewBoxContentWindow.editorDidSelectCanvas();}}
if(didPressMetaKey1(event)&&event.keyCode===76){event.preventDefault();showItemTreeMenu(ItemTreePanel);}
if(didPressMetaKey1(event)&&event.keyCode===77){event.preventDefault();PreviewBoxContentWindow.editorDidToggleIsSnapping();}
if(didPressMetaKey1(event)&&event.keyCode===73){if(MirrorPanel.is(':visible')){event.preventDefault();let isOn=MirrorPanel.find('.switch').prop('checked');PreviewBoxContentWindow.editorDidSetMirrorTransform(!isOn);setMirrorPanel(!isOn);}}
if(event.keyCode===8||event.keyCode===46){if(!$(document.activeElement).is("input")&&!$(".floatingMenu").is(":visible")){event.preventDefault();deleteSelectedItems();}}}
$(document).ready(function(){initGlobals();initPage();debug("Main editor document ready end, awaiting design initialization");});function initBoxSizes(){var headerHeight=$("#rootHeader").outerHeight();var pageBoxHeight=$(window).outerHeight()-headerHeight;var pageBox=$("#rootBody");pageBox.outerHeight(pageBoxHeight);debug("Init box sizes. Page box height: "+pageBoxHeight);}
function initGlobals(){ControlBox=$("#controlBox");MenuBox=$("#menuBox");MainBox=$("#mainBox");ItemTreePanel=ControlBox.find("#itemTreePanel");TextPanelContainer=ControlBox.find("#textPanel");GraphicPanel=ControlBox.find("#graphicPanel");BackgroundPanel=ControlBox.find("#backgroundPanel");SizePanel=ControlBox.find("#sizePanel");FramePanel=ControlBox.find("#framePanel");LandscapePanel=ControlBox.find("#landscapePanel");MirrorPanel=ControlBox.find("#mirrorPanel");RotationPanel=ControlBox.find("#rotationPanel");FilterPanel=ControlBox.find("#filterPanel");BlurPanel=ControlBox.find("#blurPanel");OpacityPanel=ControlBox.find("#opacityPanel");RepeatPanel=ControlBox.find("#repeatPanel");CornerPanel=ControlBox.find("#cornerPanel");MaskPanel=ControlBox.find("#maskPanel");CollageGridPanel=ControlBox.find("#collageGridPanel");ZoomBox=$("#zoomBox");MessageBox=$("#messageBox");FullSizeBox=$("#fullSizeBox");PricingBox=$("#pricingBox");ActionBox=$("#actionBox");GroupAlignmentBox=$("#groupAlignmentBox");GroupSpaceBox=$("#groupSpaceBox");ColorMenu=$("#colorMenu");FontMenu=$("#fontMenu");GraphicMenu=$("#graphicMenu");ScreenshotPanel=$("#screenshotPanel");ItemTreeMenu=$("#itemTreeMenu");RepeatMenu=$("#repeatMenu");SizeMenu=$("#sizeMenu");ScreenshotMenu=$("#screenshotMenu");RotationMenu=$("#rotationMenu");FilterMenu=$("#filterMenu");MaskMenu=$("#maskMenu");BlurMenu=$("#blurMenu");CornerMenu=$("#cornerMenu");CollageGridMenu=$("#collageGridMenu");TranslateMenu=$("#translateMenu");DesignPropertyMenu=$("#designPropertyMenu");RootMenuResize=$("#rootMenuResize");RootMenuFile=$("#rootMenuFile");RootMenuTool=$("#rootMenuTool");RootMenuHistory=$("#rootMenuHistory");RootMenuTranslate=$("#rootMenuTranslate");}
function hideFloatingMenus(){let visibleMenus=$('.floatingMenu:visible');for(const menu of visibleMenus){menu.contentWindow.hideOverlay(0);}}
function showFloatingMenu(floatingMenu,elem){if(!floatingMenu){return;}
var x=0;var y=0;var width=0;var height=0;if(elem){y=elem.offset().top;width=elem.width();height=elem.height();}
floatingMenu[0].contentWindow.showOverlay();floatingMenu[0].contentWindow.positionContent(x,y,width,height);}
function showFloatingMenuFullScreen(floatingMenu){floatingMenu[0].contentWindow.showOverlayBySettings();}
function deselectSizePanelInputs(selectedClass){SizePanel.find('input.'+selectedClass).removeClass(selectedClass);}
async function didClickDownloadButton(){let wasCheckoutModalViewed=false;let numCredits=1;let data=PreviewBoxContentWindow.editorWantsCollageGrid();if(data&&data.numCells>1){numCredits=data.numCells;}
let numCreditsLeft=await Db.useService(0,numCredits);if(numCreditsLeft>-1){deliverFiles(null);}else{let newId=createDesignId();let amount=100*numCredits;let orderDescription='Hotpot.ai Order. Design ID: '+newId;let cartDescription=numCredits===1?'1 graphic':numCredits+' graphics';CheckoutClass.showModal(amount,orderDescription,cartDescription,true,function(orderData){UserEmailAddress=orderData.stripeEmail;CheckoutClass.hideModal();deliverFiles(newId);didMakePayment(orderData);});wasCheckoutModalViewed=true;}
logEvent(LogCategoryName,'Download button clicked. Num credits: '+numCredits+'. Checkout modal viewed: '+wasCheckoutModalViewed,);}
function didMakePayment(orderData){if(orderData.passcode){let numCredits=orderData.orderAmount===15000?8888:1000;Db.addPlan(UserEmailAddress,0,numCredits);MessageClass.showModal('Please login to activate your pass');$('#rootHeader .message.login').show();}}
function initPreviewBox(){var previewIframe=$(document.createElement("iframe"));previewIframe.addClass("previewContent");var designURL=$("#previewBox").attr("data-edit-url");previewIframe.attr("src",designURL);$("#previewBox").append(previewIframe);PreviewBoxContentWindow=previewIframe[0].contentWindow;}
function initMainBox(){initPreviewBox();MainBox.on("click",function(){hideRootMenus();});}
function initRootHeader(){let rootMenuList=$('#rootHeader .menuListBox');rootMenuList.find('.menuName.resize').on('click',function(){toggleRootMenu(RootMenuResize,$(this));});rootMenuList.find('.menuName.file').on('click',function(){toggleRootMenu(RootMenuFile,$(this));});rootMenuList.find('.menuName.tools').on('click',function(){toggleRootMenu(RootMenuTool,$(this));});rootMenuList.find('.menuName.translate').on('click',function(){toggleRootMenu(RootMenuTranslate,$(this));});$('#rootHeader .button.help').on('click',function(e){e.preventDefault();if(drift&&drift.api){drift.api.openChat();}else{MessageClass.showMessage('Sorry, your computer blocks chat support. Please email help@hotpot.ai. We usually respond within 1 hour.');}});$('#rootHeader .button.account').on('click',function(e){openLoginWindow();});$('#rootHeader .button.icon.download').on('click',function(){didClickDownloadButton();});$('body').on('mouseenter','.rootMenuOption',function(event){let subMenu=$(this).find('.subMenu');subMenu.show();let topOffset=15;subMenu.offset({top:$(this).offset().top-topOffset,left:$(this).offset().left+$(this).outerWidth()});});$('body').on('mouseleave','.rootMenuOption',function(event){$(this).find('.subMenu').hide();});$('#rootHeader .button.icon.admin').on('click',function(){convertToTemplate();});initRootMenuFile();initRootMenuResize();initRootMenuHistory();initRootMenuTool();initRootMenuTranslate();}
function showTranslateMenu(isInstant){hideRootMenus();let textList=PreviewBoxContentWindow.editorWantsTextList();TranslateMenu[0].contentWindow.configure(textList,isInstant);let menuElem=$('#rootHeader .menuName.translate');showFloatingMenu(TranslateMenu,menuElem);logEvent(LogCategoryName,'Showed translate menu. Instant: '+isInstant);}
function initRootMenuTranslate(){let menu=RootMenuTranslate;menu.find('.rootMenuOption.instant').on('click',function(){showTranslateMenu(true);});menu.find('.rootMenuOption.manual').on('click',function(){showTranslateMenu(false);});menu.find('.rootMenuOption.translator').on('click',function(){window.open('/file-translator?s=editor-menu','_blank');});}
function initRootMenuHistory(){RootMenuHistory.on('click','.rootMenuOption',function(){let savedDesignID=$(this).attr('data-designID');let newURL='/design/blank?s=savedHistory&id='+savedDesignID;let newWindow=window.open(newURL,'_blank');});}
function initRootMenuTool(){let menu=RootMenuTool;menu.find('.rootMenuOption.backgroundRemover').on('click',function(){window.open('/remove-background?s=editor-menu','_blank');});menu.find('.rootMenuOption.imageSupersizer').on('click',function(){window.open('/enlarge-picture?s=editor-menu','_blank');});menu.find('.rootMenuOption.pictureRestorer').on('click',function(){window.open('/restore-picture?s=editor-menu','_blank');});menu.find('.rootMenuOption.colorHelper').on('click',function(){window.open('/color-generator?s=editor-menu','_blank');});menu.find('.rootMenuOption.copywriter').on('click',function(){window.open('/ai-copywriter?s=editor-menu','_blank');});menu.find('.rootMenuOption.iconResizer').on('click',function(){window.open('/icon-resizer?s=editor-menu','_blank');});menu.find('.rootMenuOption.iconCreator').on('click',function(){window.open('/free-icons?s=editor-menu','_blank');});menu.find('.rootMenuOption.svgConverter').on('click',function(){window.open('/svg-to-png-converter?s=editor-menu','_blank');});menu.find('.rootMenuOption.api').on('click',function(){window.open('/docs/api?s=editor-menu','_blank');});}
function toggleRootMenu(menu,elem){var isVisible=menu.is(':visible');hideRootMenus();menu.offset({left:$(elem).offset().left});$(elem).toggleClass("active",!isVisible);menu.toggle(!isVisible);menu.find(".subMenu").hide();}
async function showRootMenuHistory(){let user=await Db.getUser();if(!user){hideRootMenus();MessageClass.showModal('Please sign up or login first');return;}
let rootMenuName=$('#rootHeader .menuListBox .menuName.file');toggleRootMenu(RootMenuHistory,rootMenuName);setRootMenuHistory();}
async function setRootMenuHistory(){RootMenuHistory.empty();let designList=await getDesignList();designList=Object.entries(designList);if(!designList.length){MessageClass.showMessage('No designs in your history');return;}
designList.sort((a,b)=>(a[1].lastEditTime<b[1].lastEditTime?1:-1));for(const convertedEntry of designList){let element=$(document.createElement('div'));element.addClass('rootMenuOption');let designId=convertedEntry[0];let designData=await getDesignData(designId);let name=designData.name;element.attr('data-designID',designId);element.text(name);if(name){RootMenuHistory.append(element);}}
let cssOverflow='visible';let cssMaxHeight='none';let maxHeight=$(window).height()-RootMenuHistory.offset().top;if(RootMenuHistory.outerHeight()>maxHeight){cssMaxHeight=maxHeight+'px';cssOverflow='auto';}
RootMenuHistory.css('max-height',cssMaxHeight);RootMenuHistory.css('overflow',cssOverflow);}
function initRootMenuFile(){let menu=RootMenuFile;menu.find('.rootMenuOption.new').on('click',function(){createBlankCanvas();});menu.find('.rootMenuOption.save').on('click',function(){saveDesign();});menu.find('.rootMenuOption.copy').on('click',function(){copyDesign();hideRootMenus();});menu.find('.rootMenuOption.share').on('click',function(){saveDesign();let shareURL=location.href+'&share=1';ClipboardClass.copyText(shareURL);MessageClass.showMessage('Copied share URL to clipboard');});menu.find('.rootMenuOption.history').on('click',function(){showRootMenuHistory();});menu.find('.rootMenuOption.properties').on('click',function(){showDesignPropertyMenu(true);});}
function copyDesign(initData){let newURL='/design/blank?id='+CopyDesignPageID;CopyDesignInitData=initData?initData:{};let clone=PreviewBoxContentWindow.getDesignBoxDOM(false);CopyDesignInitData.designBox=clone;let newWindow=window.open(newURL,'_blank');}
function initRootMenuResize(){var menu=RootMenuResize;createCanvasResizeOptions();menu.find(".rootMenuOption.collageGrid").on("click",function(){PreviewBoxContentWindow.editorDidSelectCanvas();CollageGridPanel.find(".summary").click();});menu.on("click",".leaf",function(event){var width=$(this).data("option-width");var height=$(this).data("option-height");var newSize={width:width,height:height};var collageGridData=PreviewBoxContentWindow.editorWantsCollageGrid();if(collageGridData&&collageGridData.numCells){newSize.width=newSize.width*collageGridData.numCells;}
var initData={designSize:newSize};copyDesign(initData);});}
function createCanvasResizeOptions(){let menu=RootMenuResize;menu.empty();let collageGridElement=$(document.createElement('div'));collageGridElement.addClass('rootMenuOption collageGrid');collageGridElement.text('Collage Grid');menu.append(collageGridElement);let sizeListData=createCanvasSizeList();let template=$('#templates').find('.rootMenuOption');$.each(sizeListData,function(i,category){let categoryElem=template.clone();categoryElem.find('.label').html(category.name);let subMenuBox=categoryElem.find('.subMenu');$.each(category.options,function(i,data){let option=createSizeOption(data[0],data[1],data[2]);subMenuBox.append(option);});menu.append(categoryElem);});}
function createCanvasSizeList(){var ios={name:"iOS",options:[["App Clip",1800,1200],["App Store Icon",1024,1024],["iPad Pro",2048,2732],["iPhone 8 Plus",1242,2208],["iPhone XS Max",1242,2688],["iPhone 12 Pro",1170,2532],["iPhone 12 Pro Max",1284,2778],]};var android={name:"Android",options:[["Feature Graphic",1024,500],["Play Screenshot - Portrait",1440,2880],["Play Screenshot - Landscape",2560,1440],["Google Play Icon",512,512],["Promo Graphic",180,120],["TV Banner",1280,720],]};var mac={name:"macOS",options:[["App Store Icon",1024,1024],["Screenshot",1280,800],["Screenshot",1440,900],["Screenshot",2880,1800]]};var chrome={name:"Chrome",options:[["App Store Icon",128,128],["Screenshot",1280,800],["Promotional Small",440,280],["Promotional Large",920,680],["Promotional Marquee",1400,560],]};var facebook={name:"Facebook",options:[["Facebook Post",1200,630],["Facebook Event",1920,1080],["Facebook Cover",820,360],["Facebook Profile",180,180],]};var instagram={name:"Instagram",options:[["Instagram Story",1080,1920],["Instagram Post",1080,1080],["Instagram Profile",110,110],]};var youtube={name:"YouTube",options:[["YouTube Thumbnail",1280,720],["YouTube Banner",2560,1440],]};var social={name:"Other Social Media",options:[["LinkedIn Profile Banner",1584,396],["LinkedIn Company Cover",1536,768],["Reddit Card",1200,628],["Reddit Thumbnail",400,300],["Twitter Header",1500,500],["Twitter Profile",400,400],["Twitter In-Stream",440,220],["WeChat Post Header",900,500],["WeChat Post Preview",400,400],]};var productHunt={name:"Product Hunt",options:[["Gallery",1270,760],["Thumbnail",240,240],]};var etsy={name:"Etsy",options:[["Big Shop Banner",1600,400],["Carousel Banner",1200,300],["Collage Banner",1200,300],["Mini Shop Banner",1200,160],["Profile Photo",500,500],["Shop Icon",500,500],["Team Logo",170,100],["Order Receipt Banner",760,100],]};var ads={name:"Ads",options:[["Banner",468,60],["Banner Mobile",320,100],["Half-Page",300,600],["Leaderboard",728,90],["Leaderboard Large",970,90],["Leaderboard Mobile",320,50],["Rectangle Medium",300,250],["Rectangle Large",336,280],["Skyscraper",120,600],["Skyscraper Wide",160,600],["Square",250,250],["Square Small",200,200],]};var general={name:"General",options:[["Banner",200,100],["Background",200,200],["Button",200,100],["Footer",1280,100],["Header",1280,800],]};var print={name:"Print &bull; Flyer &bull; Poster",options:[["A0",9933,14043],["A1",7016,9933],["A2",4961,7016],["A3",3508,4961],["A4",2480,3508],["A5",1748,2480],["A6",1240,1748],["A7",874,1240],["Letter size",2250,3000],["Legal size",2250,3900],["Tabloid",3000,4800]]};return[print,ios,android,general,ads,facebook,instagram,youtube,social,mac,productHunt,etsy,chrome];}
function createSizeOption(name,width,height){var elem=$(document.createElement("div"));elem.addClass("leaf");elem.data("option-width",width);elem.data("option-height",height);var nameDiv=$(document.createElement("div"));nameDiv.addClass("name");nameDiv.html(name);var sizeDiv=$(document.createElement("div"));sizeDiv.addClass("size");sizeDiv.html(width+"x"+height);elem.append(nameDiv);elem.append(sizeDiv);return elem;}
function hideRootMenus(){$("#rootHeader .menuListBox .menuName").removeClass("active");$(".rootMenu").hide();$(".rootMenu").find(".subMenu").hide();}
function initDrift(){}
function initPage(){setTimeout(function(){window.scrollTo(0,0);},200);initDrift();initDatabase();initBoxSizes();initMainBox();initFullSizeBox();initZoomBox();initActionBox();initGroupAlignmentBox();initGroupSpaceBox();initKeyboardEvents();initClipboardEvents();initRootHeader();initSaveGuard();CanAcceptPreviewBoxInitEvent=true;}
function initSaveGuard(){window.onbeforeunload=function(){if(IsDirty){return '';}}}
function showDownloadModal(){var message="<p> For faster downloads, allow pop-up windows. </p>";message+='<a href="'+getDownloadUrl()+'" class="cta1" target="_blank"> Download graphic </div>';MessageClass.showModal(message);}
function initClipboardEvents(){$(window).on("paste",function(e){let imageFile=ClipboardClass.getImageFile();if(imageFile){didPasteImage(imageFile);}});}
function didPasteImage(file){let reader=new FileReader();reader.onload=function(e){let imageURL=reader.result;getImageSize(imageURL,function(imageWidth,imageHeight){let graphicData=Hotpot.newGraphic(imageURL,imageWidth,imageHeight);PreviewBoxContentWindow.editorDidCreateGraphic(graphicData);});};reader.readAsDataURL(file);debug('Did paste image: '+file.name);}
async function getDesignList(){let designList=JSON.parse(localStorage.getItem(LSUserDesignList));if(!designList){designList=await Db.getDesignList();if(designList){localStorage.setItem(LSUserDesignList,JSON.stringify(designList));}}
if(!designList){designList={};}
return designList;}
function getDesignName(designId,designData){let name=designData.name?designData.name:designData.designId;return name;}
async function getDesignData(designId){let designList=await getDesignList();let designData=designList[designId];if(!designData){designData={lastEditTime:new Date().getTime()};}
if(!designData.name){designData.name=designId;}
return designData;}
function setDesignId(newIdParam){let newId=newIdParam;if(!newId||!newId.includes('_')){newId=createDesignId();}
DesignID=newId;debug('Set design ID: '+DesignID);}
function createUrlWithDesignId(newId,isAbsolute){let rootURL=window.location.protocol+'//'+window.location.host+window.location.pathname;if(!isAbsolute){rootURL=window.location.pathname;}
let queryString='?id='+newId;let newURL=rootURL+queryString;return newURL;}
function initFullSizeBox(){FullSizeBox.find('.close').on('click',function(){toggleFullSizeView(false);});}
function finishInitPageFromDesign(){initControlBox();initMenuBox();PreviewBoxContentWindow.editorDidSelectCanvas();IsDirty=false;let curId=getURLParameter('id');setDesignId(curId);autoSaveDesign();$(window).resize(function(){PreviewBoxContentWindow.editorDidResizeWindow();});$('#rootBody').find('.delayedShow').removeClass('delayedShow');debug('Main editor document finished design initialization');}
function initDatabase(){Db=new HotpotFirebaseClass(userDidLogin,userDidLogout);}
function userDidLogin(emailAddress){UserEmailAddress=emailAddress;$('#rootHeader .message.login').hide();debug('User did login');}
function userDidLogout(){UserEmailAddress=null;localStorage.removeItem(LSUserDesignList);debug('User did logout');}
async function saveToDatabase(saveId,designString){let promise=$.Deferred();let storageRef=firebase.storage().ref();let firebaseStorageRootPath='designs';let designFilepath=firebaseStorageRootPath+'/'+saveId+'.txt';let metadata={contentType:"text/plain",cacheControl:"no-cache, max-age=0"};let uploadTask=storageRef.child(designFilepath).putString(designString,'raw',metadata);uploadTask.on(firebase.storage.TaskEvent.STATE_CHANGED,function(snapshot){let progress=(snapshot.bytesTransferred/snapshot.totalBytes);let saveText='Saving design 99.88%';if(progress<1){saveText='Saving design '+decimalToPercentageString(progress);}
setSaveMessageText(saveText);},function(error){promise.reject(error);},function(){didSaveDesignDataToDatabase(saveId);promise.resolve();});return promise;}
function didSaveDesignDataToDatabase(saveId){if(location.hostname!=='localhost'&&history.replaceState){let newURL=createUrlWithDesignId(DesignID,false);window.history.replaceState(null,null,newURL);}
Db.updateDesignLastEditTime(saveId);localStorage.removeItem(LSUserDesignList);}
let TutorialClass=(function(){"use strict";const LSRootKey="ai.hotpot.tutorial.seen.";let KeyList={editor:{screenshot:"screenshot"}};function didSee(tutorialKeyName){let fullName=getKeyFullName(tutorialKeyName);return localStorage.getItem(fullName);}
function setTutorial(tutorialKeyName,newValue){if(!tutorialKeyName){return;}
let fullName=getKeyFullName(tutorialKeyName);localStorage.setItem(fullName,JSON.stringify(newValue));}
function getKeyFullName(keyName){return LSRootKey+keyName;}
return{KeyList:KeyList,didSee:didSee,setTutorial:setTutorial,};})();